---
layout: post
title: 踩坑之夜
categories: Tech
author: 蓝不住
date: 2024-03-11 07:56 +0800 
---

几日前为方便通过SFTP传输文件，手贱去动了服务器的sshd_config配置，搞来搞去也没达到想要的效果，反而在退出ssh后，再尝试登入，发现出来一行 This service allows sftp connections only.

这下十分尴尬了，登不上SSH 完全束手无策。

经一番搜索，得知AWS EC2有两种方法补救，一是使用串行连接，可无奈之前未配置账户；二是把数据盘挂载到一个临时主机上，进而更改sshd_config内容。

由于这台服务器上并未存放什么关键数据，索性直接放弃这台，重新建立一个实例，无非花些时间配置环境罢了。

谁曾想，这“无非”二字让我一整晚不断落进一连串大大小小的坑里。

本以为配置环境轻车熟路，毕竟过去也曾踩了不少坑，多少也算是老马识途。哪里晓得随着版本更替，坑也在随之变化。

起初NGINX + MariaDb 顺风顺水，安装PHP时，为了与本地版本尽量接近，选择8.1而非dnf默认选择的8.2，可转头安装composer时，dnf中php-zip的版本与php8.1出现冲突，一时也查不到怎么安装低版本的PHP-ZIP ，依稀记得以前也踩过类似的坑了，可惜时间久远，踩过的坑又自行形成了。

索性直接安装8.2吧，挖个坑给以后的自己踩。

随后继续安装PhpMyAdmin，又提示未安装mysqli插件，可我明明记得安装过程中有看到mysqli的字样。先在网上搜寻相关解决办法，只得到一堆过时误导信息，尝试无果后不抱希望地试了试dnf install php-mysqli 居然搞定了，瞎忙活半天，嗐。

到此之前，大部分时间都是浪费在搜索信息上，由于我的v2ray安装在那台祸根服务器里，而一开始就把它关停了，心想一会新服务器就弄好了，懒得用临时的梯子，没想到得不偿失，偷一时的懒却成倍付出代价，同时也暴露了脱离Google寸步难行的处境。

好了，终于可以着手配置V2ray了，先前是通过脚本一键配置的，这回想着试试手动配置吧（那个脚本要使用caddy，觉得和nginx重复了，心想内存能省一点是一点）。

凭着印象写好v2ray config ，通过nginx转发请求到v2ray inbound 监听端口，一切看起来都按部就班了，可拿客户端连接却死活连不上，折腾半天，也没明白是哪里出了岔子，更诡异的是一会居然成功连上了。

反复对比前后的配置文件，看不出差别，为什么就成了呢？这样诡异的成功比清楚原因的失败更不是滋味。

罢了罢了，先用着吧，把新的配置信息复制下来，放到路由器里作透明代理，神奇的一幕又来了，先前是用的手机试连，没问题。现在不管从路由器还是电脑，却都连不上。

看一眼日志 ： VMessAEAD is enforced and a non VMessAEAD connection is received. 

辛亏这个问题一查就有了结果，把 AlterId设置为0就OK.

终于算是勉强恢复的七七八八，哎，这一夜折腾，心累，啥正事没干成，做了一晚上无用功。

事后想想，期间遇到的许多问题，都是被烦躁的心绪纠缠得陷入漩涡，越心急越烦躁，陷得越深，有时不妨跳出问题，也许能灵光一现，得到答案。

不过对我而言，这十分矛盾，我一旦把注意力离开当下，有时确实能得到放松后的灵光一闪，但更多的可能是被其他事物吸引，从而进入无止境的划水模式。

另外，所谓经验，有多大的重要性？有时正是经验让你栽跟头，理性的经验有时还不如感性的直觉。

这几天刚注册的Google Play开发者账号还没捂热即被移除，申诉无果，搞得心烦意乱，也许该停一停，想想对策，从其他方向找找出路。

不求心如止水，只希望少一点受情绪影响，不能保持一个良好的心境，想要在工作中稳步前进，自是困难。







